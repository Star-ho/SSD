---
date: 2024-04-21 15:02:55+0000
updatedAt: 2024-04-21 15:44:53+1660
tags: 
---
## 복제란?
- 지리적으로 사용자와 가깝게 데이터를 유지하면서 지연시간을 줄임
- 시스템의 일부에 장애가 발생해도 지속적으로 동작할 수 있게 해 가용성 증대
- 읽기 질의를 제공하는 장비의 수를 확장해 읽기 처리량을 증대

### 복제에서의 모든 어려움은 복제된 데이터의 변경에서 발생

## 리더와 팔로워
- 복제 서버중 하나를 리더로 지정 후, 데이터베이스에 쓰기시 리더에게 요청
- 리더는 먼저 로컬 저장소에 데이터를 기록
- 다른 복제서버는 팔로워라고 함
- 리더가 로컬 저장소에 데이터를 기록할 때마다 데이터를 복제로그나 변경스트림의 일부로 팔로워에게 전송
- 팔로워는 리더로부터 로그를 받으면 리더가 처리한것과 동일한 순서로 모든 쓰기 적용

## 동기식대 비동기식 복제
- 동기식 복제는 팔로워와 리더가 일관성 있게 최신 데이터의 복사본을 가지는것을 보장
- 하지만 팔로워가 죽거나 네트워크 장애가 발생한다면 쓰기가 처리되지 않음
- 반동기식
	- 모든 팔로워가 동기식인것은 비현실 적이기에, 하나의 팔로워는 동기식, 그밖의 팔로워는 비동기식으로 구성
- *보통 리더기반 복제는 완전히 비동기식으로 구성*

## 복제 접근 방식
### 단일 리더 복제
- 노드 중단처리
	- 팔로워 장애: 따라잡기 복구
		- 재시작 할때 리더로 부터 받은 변경로그 replay
	- 리더 장애:장애복구
		- 새로운 리더선출
### 다중리더 복제
- 단일리더 보다 나은점
	- 리더가 하나가 죽어도 ㄱㅊ음 다른 리더로 붙이면됨
	- 지리적으로 멀리 떨어진곳에 두면 지연시간이 짧음
- 쓰기 충돌 문제
	- 충돌 회피
		- 각각의 레코드의 모든 쓰기는 특정 리더를 거치도록 하는 방법
	- 일관된 상태 수렴
		- 각 쓰기에 고유 id를 부여하여 id가 가장 높은 쓰기만 채택
	- 사용자 정의 충돌 해소
		- 쓰기 발생시 사용자에게 어떻게 해결한 건지 선택권을 줌
### 리더없는 복제
- 다중 리더보다 나은점
	- 리더가 없어서 정족수만 맞춰놓으면 죽진 않음
	- 구현이 빡셈
- 정족수
- 동시쓰기 감지
- 버전백터


## 복제 지연으로 발생할 수 있는 문제
### 쓰기 후 일관성
- 사용자는 자신이 제출한 데이터를 항상 볼 수 있어야 한다
### 단조 읽기
- 사용자가 어떤 시점에 데이터를 본 후에는 예전 시점의 데이터는 나중에 볼 수 없다
### 일관된 순서로 읽기
- 사용자는 인과성 이 있는상태의 데이터를 봐야한다
	- 질문과 그에대한 담을 순서에 맞게 봐야 한다