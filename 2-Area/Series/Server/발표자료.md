---
date: 2024-05-25 22:48:55
updatedAt: 2024-05-26 11:30:04
---


1. Virtual Thread가 왜 나왔을까?
초기에 웹은 static했다
- 하나의 프로세스로 충분

동적인 웹이 필요해졌고 그때 우리는 프로세스를 새로 생성했다

프로세스를 생성하는 방식은 오버헤드가 너무컸다
- 프로그램을 메모리에 올려서 실행하고, 데이터 전달하고 하는 방식

쓰레드로 바뀌었다.
- 메모리에 있는것을 그대로 사용할 수 있었다.
- 쓰레드가 블록되면 컨텍스트 스위칭이 발생해야했다.

reactor
- 비동기로 

virtual Thread가 나왔다
- 

컴퓨팅 파워의 발전

넣을꺼
- 컨티뉴에이션

뺄꺼
- work-stealing machism

---

virtual Thread 동작 원리
continuation
carrier, 
park unpark

virtual thread의 작업단위 : task

주의점
thread local
-> 자식 쓰레드에서 Thread로컬을 사용시 부모스레드의 Thread local을 복사해서 사용
-> 메모리가 너무 커질 수 있음
-> 대안 scoped value, 메모리를 복사하는 것이 아닌, 자식 스레드에서 부모 스레드의 scoped value를 참조 가능
- https://devel-repository.tistory.com/68
syncronized
-> jni함수로 java level이 아닌, **내부코드임**
-> https://jaeyeong951.medium.com/virtual-thread-synchronized-x-6b19aaa09af1
-> synchornized내에서 blocking메서드가 있을때
-> synchronized가 아닌, synchronized를 사용시 synchronized 내부에서 blocking메서드가 있으면 unmount가 안되기 떄문에 비추함
-> synchronized관련해서는 추후에 수정될 수 있다고 함 jep-444

- pinning 감지를 위한 옵션
- `-Djdk.tracePinnedThreads=short`


poolling하지 마라
-> 따로 풀링하는 케이스는 잘 없고, tomcat에서 하는 경우가 많을텐데, tomcat에서는 사용시마다 새로운 vt를 사용하니 걱정없을것이라 판단됨

jni call은 불가능하다고 봄, java 코드가 실행되는 것이 아닌, 다른 언어의 코드가 실행되는 것이기에 java에서 통제를 못하는 것이 아닌가 생각됨


풀링

더파이러츠에서 사용 가능할까?
모든 서버가 현재 aurora에서 데이터를 가져오고 있다
Mysql connector j를 사용해서 통신을하는데, Mysql connector j에서 해당 피쳐는 9.0에 공개 예정이고, 9.0공개는 정해지지 않았음







20분
