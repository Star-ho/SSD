---
date: 2024-05-25 22:48:55
updatedAt: 2024-05-26 20:58:29
---
Virtual Thread가 무엇인가?
- 경량쓰레드
	- 다른언어 예제, C++, golang
- 무엇을 얻을 수 있는가?
	- os가 아닌, java단에서 쓰레드 스케줄링
		- blocking I/O발생 시 os쓰레드가 블로킹 되지 않는다

Virtual Tread 동작 원리
- carrier thread
- continuation
- park, unpark

- Spring에서 Virtual Tread

- 주의점
	- pinnning
		- jni call
		- syncronized
			- synchronized경우 추후 변경 가능성
	- no pooling 
	- Thread local
		- scoped value

컴퓨팅 파워의 발전

넣을꺼
- 컨티뉴에이션

뺄꺼
- work-stealing machism

---

virtual Thread 동작 원리
continuation
carrier, 
park unpark

virtual thread의 작업단위 : task

주의점
thread local
-> 자식 쓰레드에서 Thread로컬을 사용시 부모스레드의 Thread local을 복사해서 사용
-> 메모리가 너무 커질 수 있음
-> 대안 scoped value, 메모리를 복사하는 것이 아닌, 자식 스레드에서 부모 스레드의 scoped value를 참조 가능
- https://devel-repository.tistory.com/68
syncronized
-> jni함수로 java level이 아닌, **내부코드임**
-> https://jaeyeong951.medium.com/virtual-thread-synchronized-x-6b19aaa09af1
-> synchornized내에서 blocking메서드가 있을때
-> synchronized가 아닌, synchronized를 사용시 synchronized 내부에서 blocking메서드가 있으면 unmount가 안되기 떄문에 비추함
-> synchronized관련해서는 추후에 수정될 수 있다고 함 jep-444

- pinning 감지를 위한 옵션
- `-Djdk.tracePinnedThreads=short`


poolling하지 마라
-> 따로 풀링하는 케이스는 잘 없고, tomcat에서 하는 경우가 많을텐데, tomcat에서는 사용시마다 새로운 vt를 사용하니 걱정없을것이라 판단됨

jni call은 불가능하다고 봄, java 코드가 실행되는 것이 아닌, 다른 언어의 코드가 실행되는 것이기에 java에서 통제를 못하는 것이 아닌가 생각됨


풀링

더파이러츠에서 사용 가능할까?
모든 서버가 현재 aurora에서 데이터를 가져오고 있다
Mysql connector j를 사용해서 통신을하는데, Mysql connector j에서 해당 피쳐는 9.0에 공개 예정이고, 9.0공개는 정해지지 않았음







20분
