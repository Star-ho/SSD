---
date: 2024-01-19T22:52:07
---
이미 있는 테이블에 데이터복사가 이뤄져야하는 파티션을 추가하면 다운타임이 발생하겠죠?
다운타임없이 진행하려면 어떻게 해야할까요🤔
_v2테이블 만들어서 double write하면서 복사해오는 수 밖에 없으려나요?

이미 있는 테이블에 데이터복사가 이뤄져야하는 파티션을 추가하면 다운타임이 발생하겠죠?
이 말씀이 기존 테이블에 새로운 파티션을 추가하는 것이 다운타임이 발생하냐는 의미실까요 ?
기존 테이블이 파티션된 테이블인가요 ? 그리고 어떤 파티션이냐에 따라서도 다를 듯 한데, 어떤 종류의 파티션을 사용하시려는 거에요 ?

기존 테이블은 파티셔닝이 안된 로그성 테이블입니다.
구체적으로는 구매로그테이블/구매취소로그테이블인데, row수가 1억개가 넘었고, 3개월이내의 로그에 대해서만 변경이 발생해서 파티션을 추가하면 좋을듯해서 검토중입니다.
추가하게되면 1개월~3개월정도 고정단위로 레인지파티션을 할듯해요.

기존 테이블이 파티션되지 않은 상태라면... 
1) INSERT만 있고 UPDATE & DELETE & SELECT가 없다면, 기존 테이블은 rename해서 다른 이름으로 백업해두고, 새롭게 파티션된 테이블을 만들어서 요기로 INSERT되도록 해두고, 백업해둔 기존 테이블은 background로 신규 파티션 테이블로 복사하는 방법
2) 말씀하신대로, 파티션된 테이블을 만들어두고, 응용 프로그램에서 dual write를 하도록 변경후, 백그라운드로 기존 테이블에서 파티션된 테이블로 복사하는 방법
3) 2번 방법에서 dual write를 응용 프로그램이 아닌 DB trigger로 대체 구현하는 방법
4) AWS 라면, blue/green 복제후, green에서 파티션 작업후 switch하는 방법
…