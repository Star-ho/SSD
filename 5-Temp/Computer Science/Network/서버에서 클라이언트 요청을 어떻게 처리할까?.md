---
date: 2024-05-28 22:37:11
updatedAt: 2024-05-28 22:37:30
---
저 궁금한게 있습니다..
커넥션이라는게 송신자ip:송신자포트:도착지ip:도착지포트 라고 이해하고 있습니다. 그럼 하나의 송신자가 동시에 같은 도착지ip,포트 쪽으로 요청을 보낸다면 해당커넥션은 서버쪽에서 어떻게 구분되고 송신자는 각각의 요청을 개별적으로 받을 수 있는 것일까요?ㅠㅠ..

---

일단 커넥션을 요청할 때 송신자는 비어있는 포트에 소켓을 하나 할당해서 작성하구요. 수신자 측에 커넥션 요청을 전송합니다. 수신자는 리스닝 소켓으로 요청이 들어오면, 새로운 소켓을 하나 생성한 뒤 이 소켓에 커넥션 정보를 작성하는 것으로 커넥션을 완성합니다.

송신자에서 여러 요청을 보낸다면, 그만큼 송신자 측에서 비어있는 포트를 사용하여 계속 커넥션이 생기는 것이고 마찬가지고 서버 측에서 소켓이 계속 생성됩니다.

이 소켓의 구분을 file descripter = fd 로 합니다. port 도 식별정보로 쓸 수 있지만, fd 를 쓰는 이유는 fd 는 단순한 상수값이라 다루기가 쉽기 때문..

---
저도 첨언을 하자면 

웹서버 기준으로 서버의 프로세스가 시작되면 커넥션을 받도록 listening 소켓을 포트(80, 443 같은)에 바인딩 시켜서 열어 높습니다(그래서 실제로 netstat 찍어보면 listening 이라고 프린트됨) 그리고 클라/서버간의 커넥션이 established 되면 기존에 리스닝 하고 있는 소켓을 클론해 ip+포트 이름 으로 "서비스 소켓"을 만들고 그 소켓을 통해서 서버/클라가 통신 합니다. 

간혹 connection이 진짜 빡세게 한번에 몰리는 경우(예를 들면 게임 점검 후에 사용자가 한번에 spike 되는 상황)엔 TCP 핸쉑 로직 안에서도 backlog queue(기본 1024)가 있어서에서 드랍되는 경우가 있긴한데 tcp_max_syn_backlog 사이즈도 커널 파라미터로 수정 가능해요

---

